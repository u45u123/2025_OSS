<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title></title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    body {
      margin: 20px;
    }
  </style>
</head>

<body>

  <h2>학생 관리 시스템</h2>

  <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addModal">학생 추가</button>
  <button id="btnLoad" class="btn btn-secondary mb-3">목록 새로고침</button>

  <div id="contents"></div>

  <div class="modal fade" id="addModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title">학생 추가</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <input type="text" id="addName" class="form-control mb-2" placeholder="이름">
          <input type="number" id="addAge" class="form-control mb-2" placeholder="나이">
          <input type="text" id="addMajor" class="form-control mb-2" placeholder="전공">
          <input type="text" id="addGrade" class="form-control mb-2" placeholder="성적">
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
          <button class="btn btn-primary" id="btnAddSubmit">추가</button>
        </div>

      </div>
    </div>
  </div>
  
  <div class="modal fade" id="updateModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title">학생 수정</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <input type="hidden" id="editId">

          <input type="text" id="editName" class="form-control mb-2" placeholder="이름">
          <input type="number" id="editAge" class="form-control mb-2" placeholder="나이">
          <input type="text" id="editMajor" class="form-control mb-2" placeholder="전공">
          <input type="text" id="editGrade" class="form-control mb-2" placeholder="성적">
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
          <button class="btn btn-success" id="btnUpdateSubmit">변경 저장</button>
        </div>

      </div>
    </div>
  </div>

  <script>
    const API_URL = "https://691851f721a96359486fae4a.mockapi.io/students";

    $(document).ready(() => {
      $("#btnLoad").on("click", getStudents);
      $("#btnAddSubmit").on("click", addStudent);
      $("#btnUpdateSubmit").on("click", saveUpdate);

      getStudents();
    });

    function getStudents() {
      $.ajax({
        url: API_URL,
        type: "GET",
        dataType: "json",
        success: function (res) {
          $("#contents").html(makeTable(res));
        }
      });
    }

    function addStudent() {
      const data = {
        name: $("#addName").val(),
        age: $("#addAge").val(),
        major: $("#addMajor").val(),
        grade: $("#addGrade").val()
      };

      if (!data.name || !data.age || !data.major || !data.grade) {
        alert("모든 항목을 입력하세요!");
        return;
      }

      $.ajax({
        url: API_URL,
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify(data),
        success: () => {
          alert("추가 완료!");

          $("#addName, #addAge, #addMajor, #addGrade").val("");
          $("#addModal").modal("hide");
          getStudents();
        }
      });
    }
    function updateStudent(id) {
      $.ajax({
        url: `${API_URL}/${id}`,
        type: "GET",
        success: stu => {
          $("#editId").val(stu.id);
          $("#editName").val(stu.name);
          $("#editAge").val(stu.age);
          $("#editMajor").val(stu.major);
          $("#editGrade").val(stu.grade);

          const modal = new bootstrap.Modal(document.getElementById('updateModal'));
          modal.show();
        }
      });
    }

    function saveUpdate() {
      const id = $("#editId").val();

      const data = {
        name: $("#editName").val(),
        age: $("#editAge").val(),
        major: $("#editMajor").val(),
        grade: $("#editGrade").val()
      };

      $.ajax({
        url: `${API_URL}/${id}`,
        type: "PUT",
        contentType: "application/json",
        data: JSON.stringify(data),
        success: () => {
          alert("수정 완료!");
          $("#updateModal").modal("hide");
          getStudents();
        }
      });
    }

    function deleteStudent(id) {
      if (!confirm("정말 삭제하시겠습니까?")) return;

      $.ajax({
        url: `${API_URL}/${id}`,
        type: "DELETE",
        success: () => {
          alert("삭제 완료!");
          getStudents();
        }
      });
    }

    function makeTable(data) {
      let str = `
        <table class="table table-bordered">
          <tr>
            <th>ID</th><th>이름</th><th>나이</th><th>전공</th><th>성적</th><th>수정</th><th>삭제</th>
          </tr>`;

      for (let stu of data) {
        str += `
          <tr>
            <td>${stu.id}</td>
            <td>${stu.name}</td>
            <td>${stu.age}</td>
            <td>${stu.major}</td>
            <td>${stu.grade}</td>
            <td><button class="btn btn-warning btn-sm" onclick="updateStudent('${stu.id}')">수정</button></td>
            <td><button class="btn btn-danger btn-sm" onclick="deleteStudent('${stu.id}')">삭제</button></td>
          </tr>`;
      }

      str += "</table>";
      return str;
    }
  </script>

</body>

</html>
